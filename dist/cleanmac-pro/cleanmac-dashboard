#!/bin/bash
# CleanMac Pro - System Dashboard
# Enhanced with disk analysis features

set -e

echo ""
echo "ðŸš€ CleanMac Pro Enterprise Dashboard"
echo "==================================="
echo ""

# System overview
echo "ðŸ“Š SYSTEM OVERVIEW"
echo "=================="
echo "ðŸ’» Hostname: $(hostname)"
echo "ðŸ–¥ï¸  macOS: $(sw_vers -productVersion)"
echo "ðŸ‘¤ User: $(whoami)"
echo "â° Uptime: $(uptime | awk -F'( |,|:)+' '{print $6,$7",",$8,"hours,",$9,"minutes."}')"

echo ""
echo "ðŸ” ENHANCED DISK ANALYSIS"
echo "========================"

# Quick space overview - FIXED the counting issue
HOME_USAGE=$(du -sh ~ 2>/dev/null | cut -f1 || echo "unknown")
LARGE_FILES_COUNT=$(find ~ -type f -size +100M 2>/dev/null | wc -l | awk '{print $1}')

echo "ðŸ’¾ Home directory usage: $HOME_USAGE"
echo "ðŸ“ Large files (>100MB): $LARGE_FILES_COUNT"

# Docker status
if command -v docker &> /dev/null; then
    DOCKER_IMAGES=$(docker images -q 2>/dev/null | wc -l | awk '{print $1}')
    echo "ðŸ³ Docker images: $DOCKER_IMAGES"
else
    echo "ðŸ³ Docker: Not installed"
fi

# NCDU availability
if command -v ncdu &> /dev/null; then
    echo "ðŸ”¬ Disk analyzer: Available"
else
    echo "ðŸ”¬ Disk analyzer: Not installed"
fi

echo ""
echo "ðŸš€ QUICK ACTIONS"
echo "================"
echo "   cleanmac-analyze       - Explore disk usage interactively"
echo "   cleanmac-large-files   - Show largest files" 
echo "   cleanmac-docker-clean  - Clean Docker space"
echo "   cleanmac-smart-cache   - Smart cache cleaning"
echo "   cleanmac-enterprise    - Full control panel"
echo "   cleanmac-security-scan - Security audit"
echo "   cleanmac-clean-now     - Quick cleanup"

echo ""
echo "ðŸ’¡ TIPS"
echo "======"
echo "â€¢ Run 'cleanmac-analyze' first to understand disk usage"
echo "â€¢ Use 'cleanmac-large-files' to find space hogs"
echo "â€¢ Run 'cleanmac-smart-cache' monthly for maintenance"
echo "â€¢ Use 'cleanmac-docker-clean' if Docker is slow"
