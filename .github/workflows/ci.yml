name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  test:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup environment
      run: |
        # Make all scripts executable
        chmod +x tests/*.sh
        chmod +x cleanmac-*
        ls -la
        
    - name: Install dependencies
      run: |
        # Install required tools for testing
        brew install ncdu tree
        
    - name: Run comprehensive tests
      run: |
        # Run the comprehensive test suite
        ./tests/run-comprehensive-tests.sh
        
    - name: Verify documentation
      run: |
        [ -f "README.md" ] && echo "✅ README exists" || echo "❌ README missing"
        [ -f "LICENSE" ] && echo "✅ LICENSE exists" || echo "❌ LICENSE missing"
        [ -f "QUICK_START.md" ] && echo "✅ Quick start exists" || echo "❌ Quick start missing"
        [ -f "docs/PLUGINS.md" ] && echo "✅ Plugins docs exist" || echo "❌ Plugins docs missing"

  release:
    runs-on: macos-latest
    if: startsWith(github.ref, 'refs/tags/')
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Create release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          cleanmac-*
          LICENSE
          README.md
          QUICK_START.md
          docs/PLUGINS.md
